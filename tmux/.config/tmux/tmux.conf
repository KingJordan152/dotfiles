# ==================
# PLUGINS
# ==================

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'joshmedeski/tmux-nerd-font-window-name'
set -g @plugin 'mrjones2014/smart-splits.nvim'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'wfxr/tmux-fzf-url'

# Continuum settings
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# Smart-Splits settings
set -g @smart-splits_resize_left_key  'C-M-h' 
set -g @smart-splits_resize_down_key  'C-M-j' 
set -g @smart-splits_resize_up_key    'C-M-k' 
set -g @smart-splits_resize_right_key 'C-M-l' 
set -g @smart-splits_resize_step_size '2' # Change the step-size for pane resizing
set -g @smart-splits_no_wrap 'true' # Disables wrapping

# ==================
# EDITOR SETTINGS
# ==================

# Keymaps
set -g prefix C-s
bind C-l send-keys 'C-l' # Preserve screen-clearing functionality behind prefix
bind x kill-pane # Remove pane-kill confirmation
bind M-n swap-window -t +1\; select-window -t +1 # Move window one down the list
bind M-p swap-window -t -1\; select-window -t -1 # Move window one up the list
bind r {
  source-file ~/.config/tmux/tmux.conf
  display "Config reloaded!"
}

# Vim-style copy mode settings (i.e., Visual Mode)
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Fix coloring
set-option -g default-terminal "tmux-256color"
set-option -as terminal-features "xterm*:RGB:extkeys"

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Create new panes in the same working directory
bind '"' split-window -c "#{pane_current_path}"
bind % split-window -hc "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# Misc. options
set -g mouse on
set -g extended-keys on
set -gq allow-passthrough on
set -g visual-activity off
set -s escape-time 0 
set -g history-limit 50000 
set -g display-time 1500 
set -g status-interval 5
set -g focus-events on 
setw -g aggressive-resize on 
set -g status-keys emacs # Enable Emacs mode in tmux command prompt (prefix + :)

# ==================
# HIDDEN VARIABLES
# ==================

%hidden IS_COPY_MODE="#{==:#{pane_mode},copy-mode}"
%hidden IS_TREE_MODE="#{==:#{pane_mode},tree-mode}"

# Universal secondary statusbar component color
%hidden STATUS_INACTIVE="#[fg=#394262,bg=default]"

# Used for primary statusbar components
%hidden DEFAULT_STATUS="#[fg=blue,bg=default,bold]"
%hidden DEFAULT_STATUS_TEXT="#[fg=black,bg=blue,bold]"
%hidden DEFAULT_STATUS_INACTIVE_TEXT="#[fg=blue,bg=#394262]"

# Only to be used when the Tmux prefix has been pressed
%hidden PREFIX_STATUS="#[fg=yellow,bg=default,bold]"
%hidden PREFIX_STATUS_TEXT="#[fg=black,bg=yellow,bold]"
%hidden PREFIX_STATUS_INACTIVE_TEXT="#[fg=yellow,bg=#394262]"

# Only to be used when in copy-mode
%hidden COPY_MODE_STATUS="#[fg=color005,bg=default,bold]"
%hidden COPY_MODE_STATUS_TEXT="#[fg=black,bg=color005,bold]"
%hidden COPY_MODE_STATUS_INACTIVE_TEXT="#[fg=color005,bg=#394262]"

# Allows statusbar components to change color when certain events occur
%hidden DYNAMIC_STATUS="#{?#{||:#{client_prefix},#{$IS_TREE_MODE}},#{PREFIX_STATUS},#{?$IS_COPY_MODE,#{COPY_MODE_STATUS},#{DEFAULT_STATUS}}}"
%hidden DYNAMIC_STATUS_TEXT="#{?#{||:#{client_prefix},#{$IS_TREE_MODE}},#{PREFIX_STATUS_TEXT},#{?$IS_COPY_MODE,#{COPY_MODE_STATUS_TEXT},#{DEFAULT_STATUS_TEXT}}}"
%hidden DYNAMIC_STATUS_INACTIVE="#{STATUS_INACTIVE}"
%hidden DYNAMIC_STATUS_INACTIVE_TEXT="#{?#{||:#{client_prefix},#{$IS_TREE_MODE}},#{PREFIX_STATUS_INACTIVE_TEXT},#{?$IS_COPY_MODE,#{COPY_MODE_STATUS_INACTIVE_TEXT},#{DEFAULT_STATUS_INACTIVE_TEXT}}}"

# ==================
# STYLE SETTINGS
# ==================

# Statusbar Settings | General
set-option -g status-style "bg=default"
set -g status-position "top"
set -g status-justify "right" # Align window-status list to the right

# Add padding below the statusbar
set -g status-format[1] ''
set -g status 2

# Statusbar Style | Left (Session Name)
set -g status-left-length 100
set -g status-left "#{$DYNAMIC_STATUS}#{$DYNAMIC_STATUS_TEXT}  #S #{$DYNAMIC_STATUS}"
set -ga status-left "#{?window_zoomed_flag,  Zoom ,}"

# Statusbar Style | Center (Date & Time)
set -g status-right "#[align=absolute-centre]"
# --- Date
set -ga status-right "#{$DYNAMIC_STATUS_INACTIVE}#{$DYNAMIC_STATUS_INACTIVE_TEXT} 󰭦 %a %b %d #{$DYNAMIC_STATUS_INACTIVE}"
# --- Time
set -ga status-right "#{$DYNAMIC_STATUS_TEXT} 󰅐 %I:%M %p #{$DYNAMIC_STATUS}"

# Statusbar Style | Right (Window List)
set -g window-status-separator ""
# --- Current window status format
set -g window-status-current-format "#{$DYNAMIC_STATUS}#{$DYNAMIC_STATUS_TEXT} #I:#W #{$DYNAMIC_STATUS}"
# --- Inactive window status format
set -g window-status-format "#{$DYNAMIC_STATUS_INACTIVE}#{$DYNAMIC_STATUS_INACTIVE_TEXT} #I:#W #{$DYNAMIC_STATUS_INACTIVE}"
# set -g window-status-activity-style "bg=red,fg=red"
# set -g window-status-bell-style "bg=default,fg=red"

# Statusbar Style | Command
set -g message-style "bg=default,fg=yellow"
set -g prompt-cursor-color "orange" # I would use yellow, but its opacity is messed up for some reason

# Pane Style
set -g pane-border-lines "single"
set -g pane-border-style "fg=white"
set -g pane-active-border-style "fg=yellow"
set -g pane-border-status off

# Copy-Mode Styles
set -g copy-mode-selection-style "bg=#283457"
set -g copy-mode-position-style "fg=black,bg=color005"

# ==================
# BOOTSTRAP CODE
# ==================

# Bootstrap TPM if it doesn't exist
if "test ! -d ~/.tmux/plugins/tpm" \
  "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
